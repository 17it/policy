{"version":3,"sources":["tp.widget.bootstrap.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","getCookie","name","TRUSTBOX_CNAME","ca","document","cookie","split","c","charAt","substring","indexOf","setCookie","cvalue","expiryDate","topDomain","getTopLevelDomain","path","domain","expiry","join","weird_cookie","hostname","location","h","slice","getSettings","businessUnitId","storedData","JSON","parse","decodeURIComponent","window","replace","setSettings","settings","days","millisecsInADay","Date","getTime","toUTCString","encodeURIComponent","stringify","getABSettingsAsync","callback","previousSettings","sessionDuration","sessionStart","xhr","xhrGet","url","widgetIFrameProtocol","success","data","getABSettingsFromApiData","testId","session","generateGuid","previousCookieExpiry","cookieExpiry","error","b","Math","random","toString","OFF","protocol","apiData","groups","totalDistribution","numberOfGroups","validGroups","ratio","push","startBracket","toss","group","allGroups","anonymousId","./constants.js","./xhr.js","2","addEventListener","element","type","listener","options","returnObject","removeEventListener","removeListener","this","attachEvent","handler","event","preventDefault","returnValue","stopPropagation","cancelBubble","undefined","detachEvent","3","EMPTY_WIDGET_ID","4","createJsonLdElement","jsonLdData","hasCreatedJsonLd","jsonElement","createElement","setAttribute","innerHTML","head","appendChild","createComment","ignoreIE8","getServiceSnippet","schemaType","businessunitId","locale","templateId","href","console","getProductSnippet","sku","reviewnumber","language","includeImported","regularPath","importedPath","origin","pathname","snippet","dataset","5","WidgetManagement","Widget","ABSettings","version","widgets","stats","applied","findAndApplyCalls","getWidgetElements","getElementsByClassName","querySelectorAll","arrayOfElements","regularExpression","RegExp","allElements","body","getElementsByTagName","j","test","className","getWidgetElementsAndDataSets","widgetElements","datasets","getDataSet","elements","attributes","toCamelCase","str","$1","toUpperCase","dataSet","rawAttribute","nameMatch","match","trimmedAttribute","value","debounce","func","wait","context","timeout","args","arguments","later","apply","clearTimeout","setTimeout","constants","addListener","prototype","initializeOnPageLoad","readyState","Trustpilot","Modules","findAndApplyWidgets","applyWidgetFromDomElement","forceReload","alreadyLoaded","firstChild","tagName","insertJSONLDSnippets","removeWidgets","needABSettingsFor","needABSettings","that","sessionExpiry","newWidgets","applyWidgets","applyFromDomCalls","setupViewTracking","elementsAndData","normalElements","normalDatasets","abTestElements","abTestDatasets","normalWidgets","normalApplied","checkWidgetDisplayAndUpdateDataset","widget","elementDataSet","styleHeight","removeChild","widget_views","concat","checkViewPortVisbility","off","trackVisibility","splice","scrollEventListener","resizeEventListener","eventOptions","passive","capture","./addeventlistener.js","./snippets.js","6","generateWidgetId","getAttributeValue","attribute","toLowerCase","suffixRegEx","container","id","iframes","createIFrameCalls","iframeLoadEvents","events","baseUrl","widgetBaseUrl","queryString","createQueryStringFromDataSet","hasSentImpression","style","position","source","widgetHtmlFile","frameBorder","allowTransparency","scrolling","styles","borderStyle","backgroundColor","display","overflow","height","width","styleWidth","show","createIFrame","self","widgetIFrameOrigin","parsedData","ex","log","widgetId","widgetIframeMessageHandler","getIframeOptionsFromData","defaultOptions","zindex","margin","top","bottom","left","right","src","makeIframeElement","iframe","zIndex","title","command","setStyle","sendLoadedToMainFrame","sendMessage","resizeHeight","impressionData","getTrackingData","main","commandName","URL","referrer","userAgent","navigator","userLanguage","platform","setWidgetId","iframeName","property","message","contentWindow","postMessage","sendVisibilityData","hasSentViewTracking","hasBeenVisible","allowance","visible","isInViewport","rect","getBoundingClientRect","rectSize","offsetWidth","offsetHeight","innerHeight","documentElement","clientHeight","innerWidth","clientWidth","7","req","responseText","params","request","XMLHttpRequest","open","setRequestHeader","onreadystatechange","status","send","8","currentVersion","loadFromElement","postError","img","./lib/ab-settings.js","./lib/widget-management.js","./lib/widget.js"],"mappings":"CAAA,QAAUA,GAAEC,EAAEC,EAAEC,GAAG,QAASC,GAAEC,EAAEC,GAAG,IAAIJ,EAAEG,GAAG,CAAC,IAAIJ,EAAEI,GAAG,CAAC,GAAIE,GAAkB,kBAATC,UAAqBA,OAAQ,KAAIF,GAAGC,EAAE,MAAOA,GAAEF,GAAE,EAAI,IAAGI,EAAE,MAAOA,GAAEJ,GAAE,EAAI,IAAIK,GAAE,GAAIC,OAAM,uBAAuBN,EAAE,IAAK,MAAMK,GAAEE,KAAK,mBAAmBF,EAAE,GAAIG,GAAEX,EAAEG,IAAIS,WAAYb,GAAEI,GAAG,GAAGU,KAAKF,EAAEC,QAAQ,SAASd,GAAG,GAAIE,GAAED,EAAEI,GAAG,GAAGL,EAAG,OAAOI,GAAEF,EAAEA,EAAEF,IAAIa,EAAEA,EAAEC,QAAQd,EAAEC,EAAEC,EAAEC,GAAG,MAAOD,GAAEG,GAAGS,QAAkD,IAAI,GAA1CL,GAAkB,kBAATD,UAAqBA,QAAgBH,EAAE,EAAEA,EAAEF,EAAEa,OAAOX,IAAID,EAAED,EAAEE,GAAI,OAAOD,KAAKa,GAAG,SAAST,EAAQU,EAAOJ,GAMvd,QAASK,KAGL,IAAI,GAFAC,GAAOC,EAAiB,IACxBC,EAAKC,SAASC,OAAOC,MAAM,KACvBhB,EAAI,EAAGA,EAAGa,EAAGN,OAAQP,IAAK,CAEhC,IADA,GAAIiB,GAAIJ,EAAGb,GACY,MAAhBiB,EAAEC,OAAO,IACdD,EAAIA,EAAEE,UAAU,EAElB,IAAwB,IAApBF,EAAEG,QAAQT,GACZ,MAAOM,GAAEE,UAAUR,EAAKJ,OAAQU,EAAEV,SAK1C,QAASc,GAAUC,EAAQC,GACvB,GAAIC,GAAYC,IACZC,EAAO,SACPC,EAAS,UAAYH,EACrBI,EAAS,WAAaL,CAE1B,OADAT,UAASC,QAAUH,EAAiB,IAAMU,EAAQI,EAAMC,EAAQC,GAAQC,KAAK,MACtED,EAKX,QAASH,KAGL,IAAI,GAFAK,GAAa,oCACbC,EAAWjB,SAASkB,SAASD,SAASf,MAAM,KACxChB,EAAI+B,EAASxB,OAAO,EAAGP,GAAG,EAAGA,IAAK,CACtC,GAAIiC,GAAIF,EAASG,MAAMlC,GAAG6B,KAAK,IAE/B,IADAf,SAASC,OAASe,EAAe,YAAcG,EAAI,IAChDnB,SAASC,OAAOK,QAAQU,MAEvB,MADAhB,UAASC,OAASe,EAAad,MAAM,KAAK,GAAK,aAAeiB,EAAI,0CAC3DA,GAKnB,QAASE,GAAYC,GACnB,GAAIrB,EACJ,KACIA,EAASL,GACT,IAAI2B,GAAaC,KAAKC,MAAMC,mBAAmBzB,GAC/C,IAAIsB,EAAWD,iBAAmBA,EAC9B,MAAOC,GAEb,MAAM9C,GAEJ,GAAIwB,EAAQ,CACR,GAAIY,GAAS,UAAYc,OAAOT,SAASD,SAASW,QAAQ,sBAAuB,KACjF5B,UAASC,OAASH,EAAiB,kDAAoDe,IAKjG,QAASgB,GAAYC,GACjB,GAAGA,EAAU,CACT,IAAKA,EAAShB,OAAQ,CAClB,GAAIiB,GAAO,IACPC,EAAkB,KACtBF,GAAShB,OAAS,GAAKmB,OAAK,GAAIA,OAAOC,UAAYH,EAAOC,GAAkBG,cAEhF,MAAO5B,GAAU6B,mBAAmBZ,KAAKa,UAAUP,IAAYA,EAAShB,SAIhF,QAASwB,GAAmBhB,EAAgBiB,GACxC,GAAIC,GAAmBnB,EAAYC,GAC/BmB,EAAkB,IACtB,OAAGD,MAAsBA,EAAiBE,eAAiB,GAAIT,MAASO,EAAiBE,aAAeD,OACpGF,GAASC,EAAkBA,EAAiB1B,YAIhD6B,GAAIC,QAAQC,IAAKC,EAAuB,qCAAuCxB,EAC3EyB,QAAS,SAASC,GACd,GAAIlB,GAAWmB,EAAyBD,EAAM1B,EAC9C,IAAGkB,GAAoBA,EAAiBU,SAAWpB,EAASoB,OAAQ,CAEhEV,EAAiBW,QAAUC,IAC3BZ,EAAiBE,cAAgB,GAAIT,KACrC,IAAIoB,GAAuBxB,EAAYW,EACvCD,GAASC,EAAkBa,OACxB,CACH,GAAIC,GAAezB,EAAYC,EAC/BS,GAAST,EAAUwB,KAG3BC,MAAO,WACHhB,EAAS,SA4CrB,QAASa,GAAapE,EAAEwE,GAAG,IAAIA,EAAExE,EAAE,GAAGA,IAAI,GAAGwE,GAAK,GAAFxE,EAAK,IAAM,GAAFA,EAAK,EAAEyE,KAAKC,UAAY,GAAF1E,EAAK,GAAG,GAAG,GAAG2E,SAAS,IAAI,KAAK,MAAOH,GA1ItH,GAAII,GAAM3E,EAAQ,kBAAkB2E,IAChCjB,EAAM1D,EAAQ,YACd6D,EAAwB,UAAY9C,SAASkB,SAAS2C,SAAY,SAAW,QAC7E/D,EAAiB,oBAiGjBmD,EAA2B,SAASa,EAASxC,GAC7C,IAAKwC,IAAYA,EAAQC,OACrB,MAAO,KAMX,KAAK,GAHDC,GAAoB,EACpBC,EAAiB,EACjBC,KACKhF,EAAI,EAAGA,EAAI4E,EAAQC,OAAOtE,OAAQP,IACA,gBAA5B4E,GAAQC,OAAO7E,GAAGiF,QACzBH,GAAqBF,EAAQC,OAAO7E,GAAGiF,QACrCF,EACFC,EAAYE,KAAKN,EAAQC,OAAO7E,IAGxC,IAAuB,IAAnB+E,EACA,MAAO,KACmB,KAAnBA,GAAwBD,EAAoB,IAEnDE,EAAYE,MAAMvE,KAAQ+D,EAAKO,MAAS,EAAIH,IAC5CA,EAAoB,EAExB,IAAIK,GAAe,EACfC,EAAOb,KAAKC,SAAWM,EACvBO,EAAQL,EAAY,GAAGrE,KACvB2E,IACJ,KAAKtF,EAAI,EAAEA,EAAIgF,EAAYzE,OAAQP,IAC3BoF,GAAQD,GAAgBC,EAAQD,EAAeH,EAAYhF,GAAGiF,QAC9DI,EAAQL,EAAYhF,GAAGW,MAE3B2E,EAAUJ,KAAKF,EAAYhF,GAAGW,MAC9BwE,GAAgBH,EAAYhF,GAAGiF,KAGnC,QAAQK,UAAaA,EAAWD,MAASA,EAAOrB,OAAUY,EAAQZ,OAAQ5B,eAAkBA,EAAgB6B,QAAWC,IAAgBV,cAAiB,GAAIT,MAAQwC,YAAerB,KAMvLzD,GAAOJ,SAAY+C,mBAAoBA,KAEpCoC,iBAAiB,EAAEC,WAAW,IAAIC,GAAG,SAAS3F,EAAQU,EAAOJ,GAUhE,QAASsF,GAAiBC,EAASC,EAAMC,EAAUC,GAC/C,GAAIC,IAAiBJ,QAASA,EAASC,KAAMA,EAAME,QAASA,EAK5D,IAJAC,EAAaC,oBAAsB,WAC/BC,EAAeC,KAAKP,QAASO,KAAKN,KAAMM,KAAKL,SAAUK,KAAKJ,UAG5DH,EAAQD,iBACRC,EAAQD,iBAAiBE,EAAMC,EAAUC,GACzCC,EAAaF,SAAWA,MACrB,IAAIF,EAAQQ,YAAa,CAE5B,GAAIC,GAAU,SAAS9G,GACnBA,EAAIA,GAAKkD,OAAO6D,MAChB/G,EAAEgH,eAAiBhH,EAAEgH,gBAAkB,WAAahH,EAAEiH,aAAc,GACpEjH,EAAEkH,gBAAkBlH,EAAEkH,iBAAmB,WAAalH,EAAEmH,cAAe,GACvEZ,EAASxF,KAAKqG,OAAWpH,GAE7BqG,GAAQQ,YAAY,KAAOP,EAAMQ,GACjCL,EAAaF,SAAWO,EAG5B,MAAOL,GA9BX,GAAIE,GAAiB,SAASN,EAASC,EAAMC,EAAUC,GAC/CH,EAAQK,oBACRL,EAAQK,oBAAoBJ,EAAMC,EAAUC,GAExCH,EAAQK,qBACZL,EAAQgB,YAAY,KAAOf,EAAMC,GA4BzCrF,GAAOJ,QAAUsF,OAEXkB,GAAG,SAAS9G,EAAQU,EAAOJ,GACjCI,EAAOJ,SACLyG,gBAAiB,2BACjBpC,IAAK,YAGDqC,GAAG,SAAShH,EAAQU,EAAOJ,GAGjC,QAAS2G,GAAoBC,GAC3B,IACE,GAAGC,EACD,MAEF,IAAIC,GAAcrG,SAASsG,cAAc,SACzCD,GAAYE,aAAa,OAAQ,uBACjCF,EAAYG,UAAYhF,KAAKa,UAAU8D,GACvCnG,SAASyG,KAAKC,YAAY1G,SAAS2G,cAAc,wBACjD3G,SAASyG,KAAKC,YAAYL,GAC1BrG,SAASyG,KAAKC,YAAY1G,SAAS2G,cAAc,yBACjDP,GAAmB,EACnB,MAAOQ,KAMX,QAASC,GAAkBC,EAAYC,EAAgBC,EAAQC,EAAY1E,GACzE,GAAIM,GAAMgB,EACR,qDAAuDkD,EACvD,SAAWD,EACX,QAAU1E,mBAAmBT,OAAOT,SAASgG,MAC7C,eAAiBD,EACjB,WAAaD,CAEbrE,GAAIC,QAAQC,IAAKA,EACbE,QAAS,SAASC,GACdA,EAAKH,IAAM7C,SAASkB,SAASgG,KAC7B3E,EAASS,IAEbO,MAAO,SAASP,GACZmE,QAAQ5D,MAAMP,MAK1B,QAASoE,GAAkBL,EAAgBC,EAAQC,EAAYpH,EAAMwH,EAAKC,EAAc/E,GACtF,GAAIgF,GAAWP,GAAUA,EAAO9G,MAAM,KAAK,GAEvCsH,EAAiC,6BAAfP,GAA4D,6BAAfA,EAC/DQ,EAAc,8BAAgCV,EAAiB,WAC/DW,EAAe,8BAAgCX,EAAiB,oBAChEnG,EAAO4G,EAAkBE,EAAeD,EAExC5E,EAAMgB,EAAW,0BAA4BjD,EAC/C,QAAUwB,mBAAmBiF,GAC7B,qBAAuBC,GAAgB,IACvC,gBAAkBzH,EAClB,aAAe0H,EACf,eAAiBN,EACjB,QAAU7E,mBAAmBT,OAAOT,SAASyG,OAAShG,OAAOT,SAAS0G,SAEtEjF,GAAIC,QAAQC,IAAKA,EAAKE,QAASR,EAAUgB,MAAO,SAASP,GACvDmE,QAAQ5D,MAAMP,MAvDpB,GAAIoD,IAAmB,EAgBnBzD,EAAM1D,EAAQ,YACd4E,EAAW,UAAY7D,SAASkB,SAAS2C,SAAW,SAAW,QA0C/DgE,EAAU,SAASC,GACrB,OAAG1B,IAIA0B,EAAQhB,YACTD,EAAkBiB,EAAQhB,WAAYgB,EAAQf,eAAgBe,EAAQd,OAAQc,EAAQb,WAAYf,IAC3F,MACC4B,EAAQjI,OAAQiI,EAAQT,OAChCD,EAAkBU,EAAQf,eAAgBe,EAAQd,OAAQc,EAAQb,WAAYa,EAAQjI,KAAMiI,EAAQT,IAAKS,EAAQR,aAAcpB,IACxH,IAKXvG,GAAOJ,QAAUsI,IAEdlD,WAAW,IAAIoD,GAAG,SAAS9I,EAAQU,EAAOJ,GAM7C,QAASyI,GAAiBrG,EAAQ3B,EAAUiI,EAAQC,EAAYC,GAC5D9C,KAAK1D,OAASA,EACd0D,KAAKrF,SAAWA,EAChBqF,KAAK6C,WAAaA,EAClB7C,KAAK4C,OAASA,EACd5C,KAAK+C,WACL/C,KAAKgD,OAAUC,QAAS,EAAGC,kBAAmB,GAC9ClD,KAAK8C,QAAUA,EAkLnB,QAASK,GAAkBxI,GACzB,GAAIA,EAASyI,uBACT,MAAOzI,GAASyI,uBAAuB,oBACpC,IAAIzI,EAAS0I,iBAEhB,MAAO1I,GAAS0I,iBAAiB,qBAMjC,KAAK,GAHDC,MACAC,EAAoB,GAAIC,QAAO,+BAC/BC,EAAc9I,EAAS+I,KAAKC,qBAAqB,KAC5C9J,EAAI,EAAG+J,EAAIH,EAAYrJ,OAAQP,EAAI+J,EAAG/J,IACvC0J,EAAkBM,KAAKJ,EAAY5J,GAAGiK,YACtCR,EAAgBvE,KAAK0E,EAAY5J,GAGzC,OAAOyJ,GAIb,QAASS,GAA6BpJ,GAIlC,IAAK,GAHDqJ,GAAiBb,EAAkBxI,GAEnCsJ,KACKpK,EAAI,EAAGA,EAAImK,EAAe5J,OAAQP,IACvCoK,EAASlF,KAAKmF,EAAWF,EAAenK,IAG5C,QAASsK,SAAYH,EAAgBC,SAAYA,GAGrD,QAASC,GAAWzE,GAChB,GAA+B,mBAApBA,GAAQgD,QACjB,MAAOhD,GAAQgD,OAIjB,IAAKhD,EAAQ2E,WAAb,CAOA,IAAK,GAJDC,GAAc,SAASC,GACvB,MAAOA,GAAI/H,QAAQ,aAAc,SAASgI,GAAM,MAAOA,GAAGC,cAAcjI,QAAQ,IAAK,OAErFkI,KACK5K,EAAI,EAAGA,EAAI4F,EAAQ2E,WAAWhK,OAAQP,IAAK,CAChD,GAAI6K,GAAejF,EAAQ2E,WAAWvK,GAClC8K,EAAYD,EAAalK,KAAKoK,MAAM,eACxC,IAAID,EAAW,CACX,GAAIE,GAAmBR,EAAYM,EAAU,GAC7CF,GAAQI,GAAoBH,EAAaI,OAGjD,MAAOL,IAGX,QAASM,GAASC,EAAMC,EAAMC,GAC7B,GAAIC,EACJ,OAAO,YACN,GAAIC,GAAOC,UACPC,EAAQ,WACXH,EAAU,KACVH,EAAKO,MAAML,EAASE,GAErBI,cAAaL,GACbA,EAAUM,WAAWH,EAAOL,IA9P9B,GAAIS,GAAY9L,EAAQ,kBACpB+L,EAAc/L,EAAQ,yBACtB2E,EAAMmH,EAAUnH,IAChBoC,EAAkB+E,EAAU/E,eAYhCgC,GAAiBiD,UAAUC,qBAAuB,YAG1C7F,KAAKrF,SAASsF,YAA2C,aAA7BD,KAAKrF,SAASmL,WAAyD,YAA7B9F,KAAKrF,SAASmL,YAEpFxJ,OAAOyJ,WAAWC,QAAQrD,iBAAiBsD,sBACpCjG,KAAK1D,OAAO2D,YAEnBD,KAAK1D,OAAO2D,YAAY,SAAU,WAC9B3D,OAAOyJ,WAAWC,QAAQrD,iBAAiBsD,wBAG/CjG,KAAKrF,SAAS6E,iBAAiB,mBAAoB,WAC/ClD,OAAOyJ,WAAWC,QAAQrD,iBAAiBsD,yBAKvDtD,EAAiBiD,UAAUM,0BAA4B,SAASzG,EAAS0G,GACrE,GAAIC,GAAgB3G,EAAQ4G,YAA6C,WAA/B5G,EAAQ4G,WAAWC,OAE7D,KAAIF,GAAkBD,EAAtB,CAGA,GAAI1D,GAAUyB,EAAWzE,GACrB0E,GAAa1E,GACbwE,GAAaxB,EAEjB,KAAK2D,EAAe,CAChB,GAAIG,GAAuB3M,EAAQ,gBACnC2M,GAAqB9D,GAKzB,GAFAzC,KAAKwG,cAAcrC,GAEb,SAAW1B,GAIV,CACH,GAAIgE,GAAoBhE,EAAQf,cAChC1B,MAAKgD,MAAM0D,eAAiBD,CAC5B,IAAIE,GAAO3G,IACXA,MAAK6C,WAAW5F,mBAAmBwJ,EAAmB,SAAS5D,EAAY+D,GACvE,GAAIC,GAAaF,EAAKG,aAAa3C,EAAUF,EAAUpB,EAAY+D,EACnED,GAAK3D,MAAM+D,mBAAoD,EAA/BJ,EAAK3D,MAAM+D,mBAAyB,EACpEJ,EAAKK,kBAAkBH,SAXJ,CACvB,GAAIA,GAAa7G,KAAK8G,aAAa3C,EAAUF,EAC7CjE,MAAKgD,MAAM+D,mBAAoD,EAA/B/G,KAAKgD,MAAM+D,mBAAyB,EACpE/G,KAAKgH,kBAAkBH,MAe/BlE,EAAiBiD,UAAUK,oBAAsB,WAC7CjG,KAAKgD,MAAME,mBAAqB,CAEhC,IAAI+D,GAAkBlD,EAA6B/D,KAAKrF,UACpDqJ,EAAiBiD,EAAgB9C,SACjCF,EAAWgD,EAAgBhD,SAC3BwC,EAAoB,IAExB,IAAKzC,KAAkBA,EAAe5J,OAAS,GAA/C,CAKA4F,KAAKwG,cAAcS,EAAgB9C,SAMnC,KAAK,GAJDoC,GAAuB3M,EAAQ,iBAC/BsN,KAAqBC,KACrBC,KAAqBC,KAEhBxN,EAAI,EAAGA,EAAIoK,EAAS7J,OAAQP,IACjC0M,EAAqBtC,EAASpK,IACxB,SAAWoK,GAASpK,IAItBuN,EAAerI,KAAKiF,EAAenK,IACnCwN,EAAetI,KAAKkF,EAASpK,IAC7B4M,EAAoBxC,EAASpK,GAAG6H,iBALhCwF,EAAenI,KAAKiF,EAAenK,IACnCsN,EAAepI,KAAKkF,EAASpK,IAWrC,IAHAmG,KAAKgD,MAAMkE,eAAiBA,EAAe9M,OAC3C4F,KAAKgD,MAAMoE,eAAiBA,EAAehN,OAEvC8M,EAAe9M,OAAS,EAAG,CAC3B,GAAIkN,GAAgBtH,KAAK8G,aAAaI,EAAgBC,EACtDnH,MAAKgD,MAAMuE,cAAgBD,EAAclN,OACzC4F,KAAKgH,kBAAkBM,GAG3B,GAAIF,EAAehN,OAAS,EAAG,CAC3B4F,KAAKgD,MAAM0D,eAAiBD,CAC5B,IAAIE,GAAO3G,IACXA,MAAK6C,WAAW5F,mBAAmBwJ,EAAmB,SAAS5D,EAAY+D,GACvE,GAAI7D,GAAU4D,EAAKG,aAAaM,EAAgBC,EAAgBxE,EAAY+D,EAC5ED,GAAKK,kBAAkBjE,QAKnCJ,EAAiBiD,UAAUkB,aAAe,SAAU9C,EAAgBC,EAAUpB,EAAY+D,GAKtF,IAAK,GAJD9I,GAAU+E,GAAcA,EAAW/E,QACnCsB,EAAcyD,GAAcA,EAAWzD,YACvCvB,EAASgF,GAAcA,EAAWhF,OAClCoF,KACKpJ,EAAI,EAAGA,EAAImK,EAAe5J,OAAQP,IACvC,GAAImG,KAAKwH,mCAAmC3E,EAAYoB,EAASpK,IAAK,CAClE,GAAI4N,GAAS,GAAIzH,MAAK4C,OAAOoB,EAAenK,GAAIoK,EAASpK,GAAIiE,EAASsB,EAAavB,EAAQ+I,EAC3F5G,MAAKgD,MAAMC,SAAW,EACtBjD,KAAK+C,QAAQhE,KAAK0I,GAClBxE,EAAQlE,KAAK0I,GAGrB,MAAOxE,IAGXN,EAAiBiD,UAAU4B,mCAAqC,SAAS3E,EAAY6E,GACjF,QAAK7E,GAAgB,SAAW6E,MAErB7E,EAAW3D,OAASwI,EAAexI,OAEnC2D,EAAW3D,OAASX,IAC3BmJ,EAAe9F,WAAajB,EAC5B+G,EAAeC,YAAc,IAC7BD,EAAexI,MAAQX,GAChB,KAKfoE,EAAiBiD,UAAUY,cAAgB,SAAUrC,GACjDA,EAAwB3D,SAAb2D,EAAyBhB,EAAkBnD,KAAKrF,UAAYwJ,CACvE,KAAK,GAAItK,GAAI,EAAGA,EAAIsK,EAAS/J,SAAUP,EACnC,KAAOsK,EAAStK,GAAGwM,YACflC,EAAStK,GAAG+N,YAAYzD,EAAStK,GAAGwM,aAKhD1D,EAAiBiD,UAAUoB,kBAAoB,SAASjE,GACpD,GAAI/C,KAAK6H,aACL7H,KAAK6H,aAAe7H,KAAK6H,aAAaC,OAAO/E,OAC1C,CACH/C,KAAK6H,aAAe9E,EAAQhH,OAE5B,IAAIgM,GAAyBhD,EAAS,WAElC,IAAI,GAAIlL,GAAImG,KAAK6H,aAAazN,OAAS,EAAGP,GAAK,EAAIA,IAAK,CACpD,GAAI4N,GAASzH,KAAK6H,aAAahO,GAE3BmO,EAAMP,EAAO7F,aAAejB,EAC5BZ,EAAiBiI,CACjBA,KACAjI,EAAiB0H,EAAOQ,mBAEzBlI,GACCC,KAAK6H,aAAaK,OAAOrO,EAAG,GAGJ,IAA7BmG,KAAK6H,aAAazN,SACjB+N,EAAoBrI,sBACpBsI,EAAoBtI,wBAEzB,IAAKE,MAEJqI,GAAiBC,SAAS,EAAMC,SAAS,GACzCJ,EAAsBxC,EAAYrJ,OAAQ,SAAUyL,EAAwBM,GAC5ED,EAAsBzC,EAAYrJ,OAAQ,SAAUyL,EAAwBM,EAChFN,OAwERzN,EAAOJ,QAAUyI,IAEd6F,wBAAwB,EAAEnJ,iBAAiB,EAAEoJ,gBAAgB,IAAIC,GAAG,SAAS9O,EAAQU,EAAOJ,GAO/F,QAASyO,KACL,GAAItK,GAASD,KAAKC,QAClB,OAAIsK,GAAiBtK,GACVsK,KAEXA,EAAiBtK,IAAU,EACpBA,GAGX,QAASuK,GAAkBC,GACvBA,EAAYA,EAAUC,aACtB,IAAIC,GAAc,WACdjE,EAAQ,EASZ,OAPI+D,IAAaA,EAAUzO,OAAS,IAE5B0K,EADAiE,EAAYlF,KAAKgF,GACTA,EAEAA,EAAY,MAGrB/D,EAGX,QAASlC,GAAOoG,EAAWvG,EAAS3E,EAASsB,EAAavB,EAAQ+I,GAC9D,IAAKoC,EACH,KAAM,oCAER,KAAIvG,EACF,KAAM,kCAER,KAAIA,EAAQb,WACV,KAAM,qCAER,KAAIa,EAAQf,eACV,KAAM,yCAER,KAAIe,EAAQd,OACV,KAAM,iCAGR3B,MAAKiJ,GAAKN,IACV3I,KAAK4B,WAAaa,EAAQb,WAC1B5B,KAAKlC,QAAUA,EACfkC,KAAKd,MAAQuD,EAAQvD,MACrBc,KAAK4G,cAAgBA,EACrB5G,KAAKZ,YAAcA,EACnBY,KAAKnC,OAASA,EACdmC,KAAKgJ,UAAYA,EACjBhJ,KAAKkJ,WACLlJ,KAAKgD,OAAUmG,kBAAmB,EAAGC,iBAAkB,EAAGC,WAE1DrJ,KAAKsJ,QAAUC,EAAgB,IAAM9G,EAAQb,WAAa,IAC1D5B,KAAKwJ,YAAcxJ,KAAKyJ,6BAA6BhH,GACrDzC,KAAK0J,mBAAoB,EAEzB1J,KAAKgJ,UAAUW,MAAMC,SAAW,WAEhC5J,KAAKJ,SACDiK,OAAQC,EACRC,YAAa,EACbC,kBAAmB,OACnBC,UAAW,KACXC,QACIC,YAAa,OACbC,gBAAiB,cACjBC,QAAS,QACTC,SAAU,SACVC,OAAQ3B,EAAkBnG,EAAQkF,aAClC6C,MAAO5B,EAAkBnG,EAAQgI,YACjCb,SAAU,YAEdc,MAAM,GAGV1K,KAAK2K,aAAa,OAAQ3K,KAAKJ,QAE/B,IAAIgL,GAAO5K,IACX2F,GAAYrJ,OAAQ,UAAW,SAAU6D,GACrC,GAAIA,EAAMmC,SAAWuI,GAA6C,gBAAhB1K,GAAU,KAA5D,CAIA,GAAI2K,EACJ,KACIA,EAAa3O,KAAKC,MAAM+D,EAAMxC,MAChC,MAAOoN,GAEL,WADAjJ,SAAQkJ,IAAI,gCAAkC7K,EAAMxC,MAIxD,GAAImN,EAAWG,WAAaL,EAAK3B,GAAjC,CAIA,GAAI7P,IACAuE,KAAMmN,EACNxI,OAAQnC,EAAMmC,OAGlBsI,GAAKM,2BAA2B9R,OACjC,GAiLP,QAAS+R,GAAyBxN,EAAMyN,EAAgB9B,EAASE,GAC7D,GAAI5J,GAAUwL,EAAiBA,IAc/B,OAbAxL,GAAQgK,SAAWjM,EAAKuM,OAAON,UAAY,GAC3ChK,EAAQyL,OAAS1N,EAAKuM,OAAOmB,QAAU,GACvCzL,EAAQ0L,OAAS3N,EAAKuM,OAAOoB,QAAU,GACvC1L,EAAQ2L,IAAM5N,EAAKuM,OAAOqB,KAAO,GACjC3L,EAAQ4L,OAAS7N,EAAKuM,OAAOsB,QAAU,GACvC5L,EAAQ6L,KAAO9N,EAAKuM,OAAOuB,MAAQ,GACnC7L,EAAQ8L,MAAQ/N,EAAKuM,OAAOwB,OAAS,GACrC9L,EAAQ2K,OAAS5M,EAAKuM,OAAOK,QAAU,GACvC3K,EAAQ4K,MAAQ7M,EAAKuM,OAAOM,OAASY,EAAelB,OAAOM,OAAS,GACpE5K,EAAQyK,QAAU1M,EAAK+M,KAAO,QAAU,OACxC9K,EAAQ+L,IAAMrC,EAAU3L,EAAKkM,OAASL,EACtC5J,EAAQuK,YAAciB,EAAelB,OAAOC,YAC5CvK,EAAQ0K,SAAWc,EAAelB,OAAOI,SAClC1K,EAGX,QAASgM,GAAkBhM,GACvB,GAAIiM,GAASlR,SAASsG,cAAc,SAoBpC,OAnBA4K,GAAOlC,MAAMC,SAAWhK,EAAQgK,SAChCiC,EAAOlC,MAAMmC,OAASlM,EAAQyL,OAC9BQ,EAAOlC,MAAM2B,OAAS1L,EAAQ0L,OAC9BO,EAAOlC,MAAM4B,IAAM3L,EAAQ2L,IAC3BM,EAAOlC,MAAM6B,OAAS5L,EAAQ4L,OAC9BK,EAAOlC,MAAM8B,KAAO7L,EAAQ6L,KAC5BI,EAAOlC,MAAM+B,MAAQ9L,EAAQ8L,MAC7BG,EAAOlC,MAAMY,OAAS3K,EAAQ2K,OAC9BsB,EAAOlC,MAAMa,MAAQ5K,EAAQ4K,MAC7BqB,EAAOlC,MAAMQ,YAAcvK,EAAQuK,YACnC0B,EAAOlC,MAAMS,gBAAkBxK,EAAQwK,gBACvCyB,EAAOlC,MAAMU,QAAUzK,EAAQyK,QAC/BwB,EAAOlC,MAAMW,SAAW1K,EAAQ0K,SAChCuB,EAAO9B,YAAcnK,EAAQmK,YAC7B8B,EAAO5B,UAAYrK,EAAQqK,UAC3B4B,EAAO7B,kBAAoBpK,EAAQoK,kBACnC6B,EAAOE,MAAQ,yCACfF,EAAOF,IAAM/L,EAAQ+L,IAEdE,EAnUX,GAAI/B,GAAiB,aACjBrM,EAAwB,UAAY9C,SAASkB,SAAS2C,SAAY,SAAW,QAC7EqM,EAAqBpN,EAAuB,0BAC5C8L,EAAgB9L,EAAuB,qCACvCkI,EAAc/L,EAAQ,wBA0G1BgJ,GAAOgD,WACHsF,2BAA4B,SAAS/K,GAGjC,OAFAH,KAAKgD,MAAMqG,OAAOlJ,EAAMxC,KAAKqO,UAAYhM,KAAKgD,MAAMqG,OAAOlJ,EAAMxC,KAAKqO,UAAY,GAAK,EAE/E7L,EAAMxC,KAAKqO,SACf,IAAK,eACDhM,KAAK2K,aAAaxK,EAAMxC,KAAKnD,KAAM2F,EAAMxC,KACzC,MACJ,KAAK,WACDqC,KAAKiM,SAAS9L,EAAMxC,KAAKnD,KAAM2F,EAAMxC,KAAKgM,MAC1C,MACJ,KAAK,SACD3J,KAAKkM,uBACL,MACJ,KAAK,UACDlM,KAAKmM,YAAYnM,KAAKkJ,QAAQ/I,EAAMxC,KAAKnD,MAAO2F,EAAMxC,KACtD,MACJ,KAAK,gBACDqC,KAAKoM,aAAajM,EAAMxC,KAAKnD,KAAM2F,EAAMxC,KAAK4M,OAC9C,MACJ,KAAK,aACD,GAAIvK,KAAK0J,kBACL,MAEJ1J,MAAK0J,mBAAoB,CAEzB,IAAI2C,GAAiBrM,KAAKsM,gBAAgB,sBAC1CtM,MAAKmM,YAAYnM,KAAKkJ,QAAQqD,KAAMF,GACpCrM,KAAKiI,iBACL,MACJ,KAAK,yBAMbqE,gBAAiB,SAASE,GACtB,GAAI7O,IACAqO,QAASQ,EACThP,IAAKlB,OAAO3B,SAAS8R,IACrBC,SAAUpQ,OAAO3B,SAAS+R,SAC1BC,UAAWrQ,OAAOsQ,UAAUD,UAC5BzK,SAAU5F,OAAOsQ,UAAUC,cAAgBvQ,OAAOsQ,UAAU1K,SAC5D4K,SAAUxQ,OAAOsQ,UAAUE,SAgB/B,OAbI9M,MAAKlC,SAAWkC,KAAKd,QACrBvB,EAAKG,QAAUkC,KAAKlC,QACpBH,EAAKiJ,cAAgB5G,KAAK4G,eAG1B5G,KAAKZ,cACLzB,EAAKyB,YAAcY,KAAKZ,aAGxBY,KAAKnC,SACLF,EAAKE,OAASmC,KAAKnC,QAGhBF,GAGX8L,6BAA8B,SAAShF,GACnC,GAAI+E,GAAc,GAClB,KAAK,GAAIX,KAAapE,GAClB+E,GAAeX,EAAY,IAAM9L,mBAAmB0H,EAAQoE,IAAc,GAE9E,OAAOW,GAAYjN,QAAQ,YAAa,KAG5CoO,aAAc,SAASnQ,EAAMmD,GACzBqC,KAAKgD,MAAMmG,mBAAqB,CAChC,IAAI0C,GAASD,EAAkBT,EAAyBxN,EAAMqC,KAAKJ,QAASI,KAAKsJ,QAAStJ,KAAKwJ,cAC3FoB,EAAO5K,IAEXA,MAAKkJ,QAAQ1O,GAAQqR,EACrB7L,KAAKgJ,UAAU3H,YAAYwK,GAC3BlG,EAAYkG,EAAQ,OAAQ,WACxBjB,EAAKmC,YAAYlB,GACjBjB,EAAK5H,MAAMoG,kBAAoB,KAIvC6C,SAAU,SAASe,EAAY9C,GAC3B,GAAI2B,GAAS7L,KAAKkJ,QAAQ8D,IAAehN,KAAKkJ,QAAQqD,IAEtD,KAAK,GAAIU,KAAY/C,GACjB2B,EAAOlC,MAAMsD,GAAY/C,EAAO+C,IAIxCf,sBAAuB,WACnBlM,KAAKmM,YAAYnM,KAAKkJ,QAAQqD,KAAM,WAGxCH,aAAc,SAAUY,EAAYzC,GAChC,GAAwB,gBAAb,IAAoC,IAAXA,EAApC,CAIA,GAAIsB,GAAS7L,KAAKkJ,QAAQ8D,IAAehN,KAAKkJ,QAAQqD,IAClDV,KACAA,EAAOlC,MAAMY,OAASA,EAAS,QAIvC4B,YAAa,SAASN,EAAQqB,GACtBrB,EAAOsB,gBACPD,EAAU/Q,KAAKa,UAAUkQ,GACzBrB,EAAOsB,cAAcC,YAAYF,EAASrC,KAIlDkC,YAAa,SAASlB,GAClB7L,KAAKmM,YAAYN,GAAUG,QAAS,QAASf,SAAUjL,KAAKiJ,MAGhEoE,mBAAoB,WAChB,IAAGrN,KAAKsN,oBAAR,CAGAtN,KAAKsN,qBAAsB,CAE3B,IAAI3P,GAAOqC,KAAKsM,gBAAgB,uBAChCtM,MAAKmM,YAAYnM,KAAKkJ,QAAQqD,KAAM5O,KAGxCsK,gBAAiB,WAGb,GAAGjI,KAAKsN,oBACJ,OAAO,CAIX,IAAItN,KAAKuN,eAIL,MAHGvN,MAAK0J,mBACJ1J,KAAKqN,sBAEF,CAGX,IAAIG,GAAY,GACZC,EAAUzN,KAAK0N,aAAaF,EAChC,SAAIC,IAIAzN,KAAK0J,mBAKT1J,KAAKqN,sBACE,IALHrN,KAAKuN,gBAAiB,GACf,KAOfG,aAAc,SAASF,GACnB,GAAIG,GAAO3N,KAAKkJ,QAAQqD,KAAKqB,wBAEzBC,GACArD,MAAOmD,EAAKnD,OAASxK,KAAKkJ,QAAQqD,KAAKuB,YACvCvD,OAAQoD,EAAKpD,QAAUvK,KAAKkJ,QAAQqD,KAAKwB,aAG7C,OACIJ,GAAKpC,KAAO,GACZoC,EAAKlC,MAAQ,GACZkC,EAAKnC,OAAUqC,EAAStD,OAASiD,IAAgBlR,OAAO0R,aAAerT,SAASsT,gBAAgBC,eAChGP,EAAKjC,MAASmC,EAASrD,MAAQgD,IAAgBlR,OAAO6R,YAAcxT,SAASsT,gBAAgBG,eA+C1G9T,EAAOJ,QAAU0I,IAEd4F,wBAAwB,IAAI6F,GAAG,SAASzU,EAAQU,EAAOJ,GAC1D,QAASkC,GAAMkS,GACX,IACI,MAAOnS,MAAKC,MAAMkS,EAAIC,cACxB,MAAOnV,GACL,MAAOkV,GAAIC,cAInB,QAAShR,GAAOiR,GACZ,GAAIC,GAAU,GAAInS,QAAOoS,cACzBD,GAAQE,KAAK,MAAOH,EAAOhR,KAAK,GAChCiR,EAAQG,iBAAiB,eAAgB,qCACzCH,EAAQI,mBAAqB,WACE,IAAvBJ,EAAQ3I,aACJ2I,EAAQK,QAAU,KAAOL,EAAQK,OAAS,IAC1CN,EAAO9Q,QAAQtB,EAAMqS,IAElBD,EAAOtQ,OACRsQ,EAAOtQ,MAAM9B,EAAMqS,MAKjCA,EAAQM,OAGZzU,EAAOJ,SAAYqD,OAAQA,QAErByR,GAAG,SAASpV,EAAQU,EAAOJ,IAEhC,SAAS+U,GACN,YAEA,MACI,WACI,GAAIrM,GAAShJ,EAAQ,mBACjBiJ,EAAajJ,EAAQ,wBACrB+I,EAAmB/I,EAAQ,6BAE/B0C,QAAOyJ,WAAazJ,OAAOyJ,aACvBmJ,gBAAiB,SAASzP,EAAS0G,GAC/B,MAAOnG,MAAKgG,QAAQrD,kBAAoB3C,KAAKgG,QAAQrD,iBAAiBuD,0BAA0BzG,EAAS0G,KAGjH7J,OAAOyJ,WAAWC,QAAU1J,OAAOyJ,WAAWC,YAEzC1J,OAAOyJ,WAAWC,QAAQrD,iBAGpBrG,OAAOyJ,WAAWC,QAAQrD,iBAAiBG,UAAYmM,GAAkBnN,SAAWA,QAAQkJ,KACnGlJ,QAAQkJ,IAAI,mDAAoD1O,OAAOyJ,WAAWC,QAAQrD,iBAAiBG,QAAS,aAAcmM,IAHlI3S,OAAOyJ,WAAWC,QAAQrD,iBAAmB,GAAIA,GAAiBrG,OAAQ3B,SAAUiI,EAAQC,EAAYoM,GACxG3S,OAAOyJ,WAAWC,QAAQrD,iBAAiBkD,2BAKrD,MAAOzM,IACL,WACI,QAAS+V,GAAUjC,GACfpL,QAAQ5D,MAAM,sBAAwBgP,EAEtC,IAAI1P,GAAM,gDACNgR,EAAS,SAAWzR,mBAAmBmQ,GAAW,QAAUnQ,mBAAmBpC,SAAS8R,KAAO,qBAAuBwC,EAEtHG,EAAMzU,SAASsG,cAAc,MACjCmO,GAAIzD,IAAMnO,EAAM,IAAMgR,EAG1B,IAEQW,EADe,gBAAR,GACG/V,EAAE8T,QAEF9T,GAEhB,MAAOA,GACL0I,QAAQ5D,MAAM,mCAAqC9E,SAIjE,+BAECiW,uBAAuB,EAAEC,6BAA6B,EAAEC,kBAAkB,SAAS","file":"tp.widget.bootstrap.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nvar OFF = require('./constants.js').OFF;\nvar xhr = require('./xhr.js');\nvar widgetIFrameProtocol = (\"https:\" == document.location.protocol) ? \"https:\" : \"http:\";\nvar TRUSTBOX_CNAME = 'TrustboxSplitTest';\n\nfunction getCookie() {\n    var name = TRUSTBOX_CNAME + \"=\";\n    var ca = document.cookie.split(';');\n    for(var i = 0; i <ca.length; i++) {\n      var c = ca[i];\n      while (c.charAt(0) === ' ') {\n        c = c.substring(1);\n      }\n      if (c.indexOf(name) === 0) {\n        return c.substring(name.length, c.length);\n      }\n    }\n}\n\nfunction setCookie(cvalue, expiryDate) {\n    var topDomain = getTopLevelDomain();\n    var path = \"path=/\";\n    var domain = \"domain=\" + topDomain;\n    var expiry = \"expires=\" + expiryDate;\n    document.cookie = [TRUSTBOX_CNAME + \"=\" + cvalue, path, domain, expiry].join(\"; \");\n    return expiry;\n}\n\n// http://stackoverflow.com/a/11319865\n// needs to support something.co.uk, something.com.au and something.dk\nfunction getTopLevelDomain() {\n    var weird_cookie='weird_get_top_level_domain=cookie';\n    var hostname = document.location.hostname.split('.');\n    for(var i = hostname.length-1; i>=0; i--) {\n        var h = hostname.slice(i).join('.');\n        document.cookie = weird_cookie + ';domain=.' + h + ';';\n        if(document.cookie.indexOf(weird_cookie)>-1){\n            document.cookie = weird_cookie.split('=')[0] + '=;domain=.' + h + ';expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n            return h;\n        }\n    }\n}\n\nfunction getSettings(businessUnitId) {\n  var cookie;\n  try {\n      cookie = getCookie();\n      var storedData = JSON.parse(decodeURIComponent(cookie));\n      if (storedData.businessUnitId === businessUnitId) {\n          return storedData;\n      }\n  } catch(e) {\n      // Botched cookie storage, remove\n      if (cookie) {\n          var domain = \"domain=\" + window.location.hostname.replace(/^.*\\.([^.]+\\.[^.]+)/, '$1');\n          document.cookie = TRUSTBOX_CNAME + '=;expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/;' + domain;\n      }\n  }\n}\n\nfunction setSettings(settings) {\n    if(settings) {\n        if (!settings.expiry) {\n            var days = 100;\n            var millisecsInADay = 86400000;\n            settings.expiry = (new Date(new Date().getTime() + days * millisecsInADay)).toUTCString();\n        }\n        return setCookie(encodeURIComponent(JSON.stringify(settings)), settings.expiry);\n    }\n}\n\nfunction getABSettingsAsync(businessUnitId, callback) {\n    var previousSettings = getSettings(businessUnitId);\n    var sessionDuration = 1800000; // 30 mins in millisecs\n    if(previousSettings && (!previousSettings.sessionStart || +new Date() < previousSettings.sessionStart + sessionDuration)) {\n        callback(previousSettings, previousSettings.expiry);\n        return;\n    }\n\n    xhr.xhrGet({url: widgetIFrameProtocol + '#{WidgetRootNoProtocol}/v1/ratios/' + businessUnitId,\n        success: function(data) {\n            var settings = getABSettingsFromApiData(data, businessUnitId);\n            if(previousSettings && previousSettings.testId === settings.testId) {\n                // New session with same settings\n                previousSettings.session = generateGuid();\n                previousSettings.sessionStart = +new Date();\n                var previousCookieExpiry = setSettings(previousSettings);\n                callback(previousSettings, previousCookieExpiry);\n            } else {\n                var cookieExpiry = setSettings(settings);\n                callback(settings, cookieExpiry);\n            }\n        },\n        error: function() {\n            callback(null);\n        }\n    });\n}\n\n\nvar getABSettingsFromApiData = function(apiData, businessUnitId) {\n    if (!apiData || !apiData.groups) {\n        return null;\n    }\n\n    var totalDistribution = 0;\n    var numberOfGroups = 0;\n    var validGroups = [];\n    for (var i = 0; i < apiData.groups.length; i++) {\n        if (typeof apiData.groups[i].ratio === \"number\") {\n            totalDistribution += apiData.groups[i].ratio;\n            ++numberOfGroups;\n            validGroups.push(apiData.groups[i]);\n        }\n    }\n    if (numberOfGroups === 0) {\n        return null;\n    } else if (numberOfGroups === 1 && totalDistribution < 1) {\n        // Add a fake invisible group to add up to 100% distribution\n        validGroups.push({\"name\": OFF, \"ratio\": 1 - totalDistribution});\n        totalDistribution = 1;\n    }\n    var startBracket = 0;\n    var toss = Math.random() * totalDistribution; // In case we go over 1\n    var group = validGroups[0].name;\n    var allGroups = [];\n    for (i = 0;i < validGroups.length; i++) {\n        if (toss >= startBracket && toss < (startBracket + validGroups[i].ratio)) {\n            group = validGroups[i].name;\n        }\n        allGroups.push(validGroups[i].name);\n        startBracket += validGroups[i].ratio;\n    }\n    // We always generate a new anonymous ID, but it will only be used if the tp-consumer-id cookie is empty\n    return {\"allGroups\": allGroups, \"group\": group, \"testId\": apiData.testId, \"businessUnitId\": businessUnitId, \"session\": generateGuid(), \"sessionStart\": +new Date(), \"anonymousId\": generateGuid()};\n};\n\n/* https://gist.github.com/LeverOne/1308368 */\nfunction generateGuid(a,b){for(b=a='';a++<36;b+=a*51&52?(a^15?8^Math.random()*(a^20?16:4):4).toString(16):'-');return b;}\n\nmodule.exports = { getABSettingsAsync: getABSettingsAsync };\n\n},{\"./constants.js\":3,\"./xhr.js\":7}],2:[function(require,module,exports){\nvar removeListener = function(element, type, listener, options) {\n    if( element.removeEventListener) {\n        element.removeEventListener(type, listener, options);\n    }\n    else if(element.removeEventListener)  {\n        element.detachEvent('on' + type, listener);\n    }\n};\n\nfunction addEventListener(element, type, listener, options) {\n    var returnObject = { element: element, type: type, options: options };\n    returnObject.removeEventListener = function() {\n        removeListener(this.element, this.type, this.listener, this.options);\n    };\n\n    if (element.addEventListener) {\n        element.addEventListener(type, listener, options);\n        returnObject.listener = listener;\n    } else if (element.attachEvent) {\n        // IE<9\n        var handler = function(e) {\n            e = e || window.event;\n            e.preventDefault = e.preventDefault || function() { e.returnValue = false; };\n            e.stopPropagation = e.stopPropagation || function() { e.cancelBubble = true; };\n            listener.call(undefined, e);\n        };\n        element.attachEvent('on' + type, handler);\n        returnObject.listener = handler;\n    }\n\n    return returnObject;\n}\n\nmodule.exports = addEventListener;\n\n},{}],3:[function(require,module,exports){\nmodule.exports = {\n  EMPTY_WIDGET_ID: \"000000000000000000000000\",\n  OFF: \"OFF\"\n};\n\n},{}],4:[function(require,module,exports){\n\nvar hasCreatedJsonLd = false;\nfunction createJsonLdElement(jsonLdData) {\n  try {\n    if(hasCreatedJsonLd) {\n      return;\n    }\n    var jsonElement = document.createElement('script');\n    jsonElement.setAttribute(\"type\", \"application/ld+json\");\n    jsonElement.innerHTML = JSON.stringify(jsonLdData);\n    document.head.appendChild(document.createComment('Added by Trustpilot'));\n    document.head.appendChild(jsonElement);\n    document.head.appendChild(document.createComment('/Added by Trustpilot'));\n    hasCreatedJsonLd = true;\n  } catch (ignoreIE8) {}\n}\n\nvar xhr = require('./xhr.js');\nvar protocol = \"https:\" == document.location.protocol ? \"https:\" : \"http:\";\n\nfunction getServiceSnippet(schemaType, businessunitId, locale, templateId, callback) {\n  var url = protocol +\n    '#{WidgetRootNoProtocol}/data/jsonld/business-unit/' + businessunitId +\n    '?type=' + schemaType +\n    '&url=' + encodeURIComponent(window.location.href) +\n    '&templateId=' + templateId +\n    '&locale=' + locale;\n\n    xhr.xhrGet({url: url,\n        success: function(data) {\n            data.url = document.location.href;\n            callback(data);\n        },\n        error: function(data) {\n            console.error(data);\n        }\n    });\n}\n\nfunction getProductSnippet(businessunitId, locale, templateId, name, sku, reviewnumber, callback) {\n  var language = locale && locale.split('-')[0];\n\n  var includeImported = templateId === '5763ba71ba484803e8b222ba' || templateId === '5763bccae0a06d08e809ecbb'; // multisource seo staging and prod\n  var regularPath = '/data/jsonld/business-unit/' + businessunitId + '/product';\n  var importedPath = '/data/jsonld/business-unit/' + businessunitId + '/product-imported';\n  var path = includeImported ? importedPath : regularPath;\n\n  var url = protocol + '#{WidgetRootNoProtocol}' + path +\n    '?sku=' + encodeURIComponent(sku) +\n    '&numberOfReviews=' + (reviewnumber || 10) +\n    '&productName=' + name +\n    '&language=' + language +\n    '&templateId=' + templateId +\n    '&url=' + encodeURIComponent(window.location.origin + window.location.pathname);\n\n    xhr.xhrGet({url: url, success: callback, error: function(data) {\n      console.error(data);\n    }});\n}\n\nvar snippet = function(dataset) {\n  if(hasCreatedJsonLd) { // in case there's a second widget with snippet markup\n    return false;\n  }\n\n  if(dataset.schemaType) { // organisation JSON-LD\n    getServiceSnippet(dataset.schemaType, dataset.businessunitId, dataset.locale, dataset.templateId, createJsonLdElement);\n    return true;\n  } else if(dataset.name && dataset.sku) { // product JSON-LD\n    getProductSnippet(dataset.businessunitId, dataset.locale, dataset.templateId, dataset.name, dataset.sku, dataset.reviewnumber, createJsonLdElement);\n    return true;\n  }\n  return false;\n};\n\nmodule.exports = snippet;\n\n},{\"./xhr.js\":7}],5:[function(require,module,exports){\nvar constants = require('./constants.js');\nvar addListener = require('./addeventlistener.js');\nvar OFF = constants.OFF,\n    EMPTY_WIDGET_ID = constants.EMPTY_WIDGET_ID;\n\nfunction WidgetManagement(window, document, Widget, ABSettings, version) {\n    this.window = window;\n    this.document = document;\n    this.ABSettings = ABSettings;\n    this.Widget = Widget;\n    this.widgets = [];\n    this.stats = { applied: 0, findAndApplyCalls: 0 };\n    this.version = version;\n}\n\nWidgetManagement.prototype.initializeOnPageLoad = function() {\n    // We try to bank on readyState === 'interactive' but with the following caveat:\n    // https://github.com/jquery/jquery/commit/0f553ed0ca0c50c5f66377e9f2c6314f822e8f25\n    if (this.document.attachEvent ? this.document.readyState === \"complete\" : this.document.readyState !== \"loading\") {\n        // Events have already fired, we can go in\n        window.Trustpilot.Modules.WidgetManagement.findAndApplyWidgets();\n    } else if (this.window.attachEvent) {\n        // Anonymous function needed to bind \"this\" to the expected value.\n        this.window.attachEvent(\"onload\", function() {\n            window.Trustpilot.Modules.WidgetManagement.findAndApplyWidgets();\n        });\n    } else {\n        this.document.addEventListener(\"DOMContentLoaded\", function() {\n            window.Trustpilot.Modules.WidgetManagement.findAndApplyWidgets();\n        });\n    }\n};\n\nWidgetManagement.prototype.applyWidgetFromDomElement = function(element, forceReload) {\n    var alreadyLoaded = element.firstChild && element.firstChild.tagName === \"IFRAME\";\n\n    if (alreadyLoaded && !forceReload) {\n        return;\n    }\n    var dataset = getDataSet(element);\n    var elements = [ element ];\n    var datasets = [ dataset ];\n\n    if (!alreadyLoaded) {\n        var insertJSONLDSnippets = require('./snippets.js');\n        insertJSONLDSnippets(dataset);\n    }\n\n    this.removeWidgets(elements);\n\n    if (!('group' in dataset)) {\n        var newWidgets = this.applyWidgets(elements, datasets);\n        this.stats.applyFromDomCalls = (this.stats.applyFromDomCalls | 0) + 1;\n        this.setupViewTracking(newWidgets);\n    } else {\n        var needABSettingsFor = dataset.businessunitId;\n        this.stats.needABSettings = needABSettingsFor;\n        var that = this;\n        this.ABSettings.getABSettingsAsync(needABSettingsFor, function(ABSettings, sessionExpiry) {\n            var newWidgets = that.applyWidgets(elements, datasets, ABSettings, sessionExpiry);\n            that.stats.applyFromDomCalls = (that.stats.applyFromDomCalls | 0) + 1;\n            that.setupViewTracking(newWidgets);\n        });\n    }\n};\n\n// This method is called by some of our clients when using SPAs\n// We should ensure `window.Trustpilot.Modules.WidgetManagement.findAndApplyWidgets()` always works\nWidgetManagement.prototype.findAndApplyWidgets = function () {\n    this.stats.findAndApplyCalls += 1;\n\n    var elementsAndData = getWidgetElementsAndDataSets(this.document);\n    var widgetElements = elementsAndData.elements;\n    var datasets = elementsAndData.datasets;\n    var needABSettingsFor = null;\n\n    if (!widgetElements || widgetElements.length < 1) {\n        return;\n    }\n\n    // Cleanup links (new way of loading, straight to stage 2 bootstrap)\n    this.removeWidgets(elementsAndData.elements);\n\n    var insertJSONLDSnippets = require('./snippets.js');\n    var normalElements = [], normalDatasets = [];\n    var abTestElements = [], abTestDatasets = [];\n\n    for (var i = 0; i < datasets.length; i++) {\n        insertJSONLDSnippets(datasets[i]);\n        if (!('group' in datasets[i])) {\n            normalElements.push(widgetElements[i]);\n            normalDatasets.push(datasets[i]);\n        } else {\n            abTestElements.push(widgetElements[i]);\n            abTestDatasets.push(datasets[i]);\n            needABSettingsFor = datasets[i].businessunitId;\n        }\n    }\n\n    this.stats.normalElements = normalElements.length;\n    this.stats.abTestElements = abTestElements.length;\n\n    if (normalElements.length > 0) {\n        var normalWidgets = this.applyWidgets(normalElements, normalDatasets);\n        this.stats.normalApplied = normalWidgets.length;\n        this.setupViewTracking(normalWidgets);\n    }\n\n    if (abTestElements.length > 0) {\n        this.stats.needABSettings = needABSettingsFor;\n        var that = this;\n        this.ABSettings.getABSettingsAsync(needABSettingsFor, function(ABSettings, sessionExpiry) {\n            var widgets = that.applyWidgets(abTestElements, abTestDatasets, ABSettings, sessionExpiry);\n            that.setupViewTracking(widgets);\n        });\n    }\n};\n\nWidgetManagement.prototype.applyWidgets = function (widgetElements, datasets, ABSettings, sessionExpiry) {\n    var session = ABSettings && ABSettings.session;\n    var anonymousId = ABSettings && ABSettings.anonymousId;\n    var testId = ABSettings && ABSettings.testId;\n    var applied = [];\n    for (var i = 0; i < widgetElements.length; i++) {\n        if (this.checkWidgetDisplayAndUpdateDataset(ABSettings, datasets[i])) {\n            var widget = new this.Widget(widgetElements[i], datasets[i], session, anonymousId, testId, sessionExpiry);\n            this.stats.applied += 1;\n            this.widgets.push(widget);\n            applied.push(widget);\n        }\n    }\n    return applied;\n};\n\nWidgetManagement.prototype.checkWidgetDisplayAndUpdateDataset = function(ABSettings, elementDataSet) {\n    if (!ABSettings || !('group' in elementDataSet)) {\n        return true;\n    } else if (ABSettings.group == elementDataSet.group) {\n        return true;\n    } else if (ABSettings.group == OFF) {\n        elementDataSet.templateId = EMPTY_WIDGET_ID;\n        elementDataSet.styleHeight = '0';\n        elementDataSet.group = OFF;\n        return true;\n    }\n    return false;\n};\n\nWidgetManagement.prototype.removeWidgets = function (elements) {\n    elements = elements === undefined ? getWidgetElements(this.document) : elements;\n    for (var i = 0; i < elements.length; ++i) {\n        while (elements[i].firstChild) {\n            elements[i].removeChild(elements[i].firstChild);\n        }\n    }\n};\n\nWidgetManagement.prototype.setupViewTracking = function(widgets) {\n    if (this.widget_views) {\n        this.widget_views = this.widget_views.concat(widgets);\n    } else {\n        this.widget_views = widgets.slice();\n\n        var checkViewPortVisbility = debounce(function() {\n            // Loop backwards to avoid losing steps if a remove occurs\n            for(var i = this.widget_views.length - 1; i >= 0 ; i--) {\n                var widget = this.widget_views[i];\n\n                var off = widget.templateId === EMPTY_WIDGET_ID; // Filter out empty iframe widgets from the view tracking\n                var removeListener = off;\n                if(!off) {\n                    removeListener = widget.trackVisibility();\n                }\n                if(removeListener) {\n                    this.widget_views.splice(i, 1);\n                }\n            }\n            if(this.widget_views.length === 0) {\n                scrollEventListener.removeEventListener();\n                resizeEventListener.removeEventListener();\n            }\n        }, 100, this);\n\n        var eventOptions = { passive: true, capture: false };\n        var scrollEventListener = addListener(window, 'scroll', checkViewPortVisbility, eventOptions);\n        var resizeEventListener = addListener(window, 'resize', checkViewPortVisbility, eventOptions);\n        checkViewPortVisbility();\n    }\n};\n\nfunction getWidgetElements(document) {\n  if (document.getElementsByClassName) {\n      return document.getElementsByClassName('trustpilot-widget');\n  } else if (document.querySelectorAll) {\n      // IE8\n      return document.querySelectorAll('.trustpilot-widget');\n  } else {\n      // IE7\n      var arrayOfElements = [];\n      var regularExpression = new RegExp('(^| )trustpilot-widget( |$)');\n      var allElements = document.body.getElementsByTagName(\"*\");\n      for (var i = 0, j = allElements.length; i < j; i++) {\n          if (regularExpression.test(allElements[i].className)) {\n              arrayOfElements.push(allElements[i]);\n          }\n      }\n      return arrayOfElements;\n  }\n}\n\nfunction getWidgetElementsAndDataSets(document) {\n    var widgetElements = getWidgetElements(document);\n\n    var datasets = [];\n    for (var i = 0; i < widgetElements.length; i++) {\n        datasets.push(getDataSet(widgetElements[i]));\n    }\n\n    return { \"elements\": widgetElements, \"datasets\": datasets };\n}\n\nfunction getDataSet(element) {\n    if (typeof element.dataset !== 'undefined') {\n      return element.dataset;\n    }\n\n    // IE 8/9\n    if (!element.attributes) {\n        return undefined;\n    }\n    var toCamelCase = function(str) {\n        return str.replace(/(\\-[a-z])/g, function($1) { return $1.toUpperCase().replace('-', ''); });\n    };\n    var dataSet = {};\n    for (var i = 0; i < element.attributes.length; i++) {\n        var rawAttribute = element.attributes[i];\n        var nameMatch = rawAttribute.name.match(/^data-(.+)$/i);\n        if (nameMatch) {\n            var trimmedAttribute = toCamelCase(nameMatch[1]);\n            dataSet[trimmedAttribute] = rawAttribute.value;\n        }\n    }\n    return dataSet;\n}\n\nfunction debounce(func, wait, context) {\n\tvar timeout;\n\treturn function() {\n\t\tvar args = arguments;\n\t\tvar later = function() {\n\t\t\ttimeout = null;\n\t\t\tfunc.apply(context, args);\n\t\t};\n\t\tclearTimeout(timeout);\n\t\ttimeout = setTimeout(later, wait);\n\t};\n}\n\nmodule.exports = WidgetManagement;\n\n},{\"./addeventlistener.js\":2,\"./constants.js\":3,\"./snippets.js\":4}],6:[function(require,module,exports){\nvar widgetHtmlFile = 'index.html',\n    widgetIFrameProtocol = (\"https:\" == document.location.protocol) ? \"https:\" : \"http:\",\n    widgetIFrameOrigin = widgetIFrameProtocol + '#{WidgetRootNoProtocol}',\n    widgetBaseUrl = widgetIFrameProtocol + '#{WidgetRootNoProtocol}/trustboxes',\n    addListener = require('./addeventlistener.js');\n\nfunction generateWidgetId() {\n    var random = Math.random();\n    if (generateWidgetId[random]) {\n        return generateWidgetId();\n    }\n    generateWidgetId[random] = true;\n    return random;\n}\n\nfunction getAttributeValue(attribute) {\n    attribute = attribute.toLowerCase();\n    var suffixRegEx = /(px|\\%)/i;\n    var value = '';\n\n    if (attribute && attribute.length > 0) {\n        if (suffixRegEx.test(attribute)) {\n            value = attribute;\n        } else {\n            value = attribute + 'px';\n        }\n    }\n    return value;\n}\n\nfunction Widget(container, dataset, session, anonymousId, testId, sessionExpiry) {\n    if (!container) {\n      throw \"No container supplied for TrustBox\";\n    }\n    if(!dataset) {\n      throw \"No dataset supplied for TrustBox\";\n    }\n    if(!dataset.templateId) {\n      throw \"No templateId supplied for TrustBox\";\n    }\n    if(!dataset.businessunitId) {\n      throw \"No businessunitId supplied for TrustBox\";\n    }\n    if(!dataset.locale) {\n      throw \"No locale supplied for TrustBox\";\n    }\n\n    this.id = generateWidgetId();\n    this.templateId = dataset.templateId;\n    this.session = session;\n    this.group = dataset.group;\n    this.sessionExpiry = sessionExpiry;\n    this.anonymousId = anonymousId;\n    this.testId = testId;\n    this.container = container;\n    this.iframes = {};\n    this.stats = { createIFrameCalls: 0, iframeLoadEvents: 0, events: {} };\n\n    this.baseUrl = widgetBaseUrl + '/' + dataset.templateId + '/';\n    this.queryString = this.createQueryStringFromDataSet(dataset);\n    this.hasSentImpression = false;\n\n    this.container.style.position = \"relative\";\n\n    this.options = {\n        source: widgetHtmlFile,\n        frameBorder: 0,\n        allowTransparency: 'true',\n        scrolling: 'no',\n        styles: {\n            borderStyle: 'none',\n            backgroundColor: 'transparent',\n            display: 'block',\n            overflow: 'hidden',\n            height: getAttributeValue(dataset.styleHeight),\n            width: getAttributeValue(dataset.styleWidth),\n            position: 'relative'\n        },\n        show: true\n    };\n\n    this.createIFrame('main', this.options);\n\n    var self = this;\n    addListener(window, \"message\", function (event) {\n        if (event.origin !== widgetIFrameOrigin || typeof(event.data) !== \"string\") {\n            return;\n        }\n\n        var parsedData;\n        try {\n            parsedData = JSON.parse(event.data); // This is to make it IE8 compatible\n        } catch (ex) {\n            console.log(\"Invalid data sent on widget: \" + event.data);\n            return;\n        }\n\n        if (parsedData.widgetId !== self.id) {\n            return;\n        }\n\n        var e = {\n            data: parsedData,\n            origin: event.origin\n        };\n\n        self.widgetIframeMessageHandler(e);\n    }, false);\n}\n\nWidget.prototype = {\n    widgetIframeMessageHandler: function(event) {\n        this.stats.events[event.data.command] = (this.stats.events[event.data.command] || 0) + 1;\n\n        switch (event.data.command) {\n            case 'createIFrame':\n                this.createIFrame(event.data.name, event.data);\n                break;\n            case 'setStyle':\n                this.setStyle(event.data.name, event.data.style);\n                break;\n            case 'loaded':\n                this.sendLoadedToMainFrame();\n                break;\n            case 'message':\n                this.sendMessage(this.iframes[event.data.name], event.data);\n                break;\n            case 'resize-height':\n                this.resizeHeight(event.data.name, event.data.height);\n                break;\n            case 'impression':\n                if (this.hasSentImpression) {\n                    return;\n                }\n                this.hasSentImpression = true;\n\n                var impressionData = this.getTrackingData('impression-received');\n                this.sendMessage(this.iframes.main, impressionData);\n                this.trackVisibility();\n                break;\n            case 'product-review-data':\n                /* this is handled in the bootstrap now, remove this case when the widgets no longer send it */\n                break;\n        }\n    },\n\n    getTrackingData: function(commandName) {\n        var data = {\n            command: commandName,\n            url: window.document.URL,\n            referrer: window.document.referrer,\n            userAgent: window.navigator.userAgent,\n            language: window.navigator.userLanguage || window.navigator.language,\n            platform: window.navigator.platform\n        };\n\n        if (this.session && this.group) {\n            data.session = this.session;\n            data.sessionExpiry = this.sessionExpiry;\n        }\n\n        if (this.anonymousId) {\n            data.anonymousId = this.anonymousId;\n        }\n\n        if (this.testId) {\n            data.testId = this.testId;\n        }\n\n        return data;\n    },\n\n    createQueryStringFromDataSet: function(dataSet) {\n        var queryString = \"?\";\n        for (var attribute in dataSet) {\n            queryString += attribute + '=' + encodeURIComponent(dataSet[attribute]) + '&';\n        }\n        return queryString.replace(/(\\&|\\?)+$/, \"\");\n    },\n\n    createIFrame: function(name, data) {\n        this.stats.createIFrameCalls += 1;\n        var iframe = makeIframeElement(getIframeOptionsFromData(data, this.options, this.baseUrl, this.queryString)),\n            self = this;\n\n        this.iframes[name] = iframe;\n        this.container.appendChild(iframe);\n        addListener(iframe, 'load', function() {\n            self.setWidgetId(iframe);\n            self.stats.iframeLoadEvents += 1;\n        });\n    },\n\n    setStyle: function(iframeName, styles) {\n        var iframe = this.iframes[iframeName] || this.iframes.main;\n\n        for (var property in styles) {\n            iframe.style[property] = styles[property];\n        }\n    },\n\n    sendLoadedToMainFrame: function() {\n        this.sendMessage(this.iframes.main, 'loaded');\n    },\n\n    resizeHeight: function (iframeName, height) {\n        if (typeof (height) !== \"number\" || height === 0) {\n            return;\n        }\n\n        var iframe = this.iframes[iframeName] || this.iframes.main;\n        if (iframe) {\n            iframe.style.height = height + \"px\";\n        }\n    },\n\n    sendMessage: function(iframe, message) {\n        if (iframe.contentWindow) {\n            message = JSON.stringify(message); // This is to make it IE8 compatible\n            iframe.contentWindow.postMessage(message, widgetIFrameOrigin);\n        }\n    },\n\n    setWidgetId: function(iframe) {\n        this.sendMessage(iframe, { command: 'setId', widgetId: this.id });\n    },\n\n    sendVisibilityData: function() {\n        if(this.hasSentViewTracking) {\n          return;\n        }\n        this.hasSentViewTracking = true;\n\n        var data = this.getTrackingData('trustbox-in-viewport');\n        this.sendMessage(this.iframes.main, data);\n    },\n\n    trackVisibility: function() {\n        // we can't send the view data until the iframe is ready to receive it, we're using `hasSentImpression`\n        // to know it's loaded and rely on the `impression` message handler to call us when that changes\n        if(this.hasSentViewTracking) {\n            return true;\n        }\n\n        // already detected it, weren't ready to send earlier though\n        if (this.hasBeenVisible) {\n            if(this.hasSentImpression) {\n                this.sendVisibilityData();\n            }\n            return true;\n        }\n\n        var allowance = 0.5;\n        var visible = this.isInViewport(allowance);\n        if(!visible) {\n            return false;\n        }\n\n        if(!this.hasSentImpression) {\n            this.hasBeenVisible = true;\n            return true;\n        }\n\n        this.sendVisibilityData();\n        return true;\n    },\n\n    isInViewport: function(allowance) {\n        var rect = this.iframes.main.getBoundingClientRect();\n\n        var rectSize = {\n            width: rect.width || this.iframes.main.offsetWidth,\n            height: rect.height || this.iframes.main.offsetHeight\n        };\n\n        return (\n            rect.top >= 0 &&\n            rect.left >= 0 &&\n            (rect.bottom - (rectSize.height * allowance)) <= (window.innerHeight || document.documentElement.clientHeight) &&\n            (rect.right - (rectSize.width * allowance)) <= (window.innerWidth || document.documentElement.clientWidth)\n        );\n    }\n};\n\nfunction getIframeOptionsFromData(data, defaultOptions, baseUrl, queryString) {\n    var options = defaultOptions ? defaultOptions : {};\n    options.position = data.styles.position || '';\n    options.zindex = data.styles.zindex || '';\n    options.margin = data.styles.margin || '';\n    options.top = data.styles.top || '';\n    options.bottom = data.styles.bottom || '';\n    options.left = data.styles.left || '';\n    options.right = data.styles.right || '';\n    options.height = data.styles.height || '';\n    options.width = data.styles.width || defaultOptions.styles.width || '';\n    options.display = data.show ? 'block' : 'none';\n    options.src = baseUrl + data.source + queryString;\n    options.borderStyle = defaultOptions.styles.borderStyle;\n    options.overflow = defaultOptions.styles.overflow;\n    return options;\n}\n\nfunction makeIframeElement(options) {\n    var iframe = document.createElement('iframe');\n    iframe.style.position = options.position;\n    iframe.style.zIndex = options.zindex;\n    iframe.style.margin = options.margin;\n    iframe.style.top = options.top;\n    iframe.style.bottom = options.bottom;\n    iframe.style.left = options.left;\n    iframe.style.right = options.right;\n    iframe.style.height = options.height;\n    iframe.style.width = options.width;\n    iframe.style.borderStyle = options.borderStyle;\n    iframe.style.backgroundColor = options.backgroundColor;\n    iframe.style.display = options.display;\n    iframe.style.overflow = options.overflow;\n    iframe.frameBorder = options.frameBorder;\n    iframe.scrolling = options.scrolling;\n    iframe.allowTransparency = options.allowTransparency;\n    iframe.title = 'Customer reviews powered by Trustpilot';\n    iframe.src = options.src;\n\n    return iframe;\n}\n\nmodule.exports = Widget;\n\n},{\"./addeventlistener.js\":2}],7:[function(require,module,exports){\nfunction parse(req) {\n    try {\n        return JSON.parse(req.responseText);\n    } catch (e) {\n        return req.responseText;\n    }\n}\n\nfunction xhrGet(params) {\n    var request = new window.XMLHttpRequest();\n    request.open('GET', params.url, true);\n    request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n    request.onreadystatechange = function () {\n        if (request.readyState === 4) {\n            if (request.status >= 200 && request.status < 300) {\n                params.success(parse(request));\n            } else {\n                if(params.error) {\n                  params.error(parse(request));\n                }\n            }\n        }\n    };\n    request.send();\n}\n\nmodule.exports = { xhrGet: xhrGet };\n\n},{}],8:[function(require,module,exports){\n/* jslint browser: true */\n(function(currentVersion) {\n    'use strict';\n\n    try {\n        (function() {\n            var Widget = require('./lib/widget.js');\n            var ABSettings = require('./lib/ab-settings.js');\n            var WidgetManagement = require('./lib/widget-management.js');\n\n            window.Trustpilot = window.Trustpilot || {\n                loadFromElement: function(element, forceReload) {\n                    return this.Modules.WidgetManagement && this.Modules.WidgetManagement.applyWidgetFromDomElement(element, forceReload);\n                }\n            };\n            window.Trustpilot.Modules = window.Trustpilot.Modules || {};\n\n            if (!window.Trustpilot.Modules.WidgetManagement) {\n                window.Trustpilot.Modules.WidgetManagement = new WidgetManagement(window, document, Widget, ABSettings, currentVersion);\n                window.Trustpilot.Modules.WidgetManagement.initializeOnPageLoad();\n            } else if (window.Trustpilot.Modules.WidgetManagement.version !== currentVersion && console && console.log) {\n                console.log('Detected legacy TrustBox bootstrap with version:', window.Trustpilot.Modules.WidgetManagement.version, ', current:', currentVersion);\n            }\n        })();\n    } catch (e) {\n        (function() {\n            function postError(message) {\n                console.error(\"Error on bootstrap:\" + message);\n\n                var url = \"#{WidgetRootNoProtocol}/feedback/report-error\";\n                var params = \"error=\" + encodeURIComponent(message) + \"&uri=\" + encodeURIComponent(document.URL) + \"&bootstrapVersion=\" + currentVersion;\n\n                var img = document.createElement(\"img\");\n                img.src = url + \"?\" + params;\n            }\n\n            try {\n                if (typeof (e) === \"object\") {\n                    postError(e.message);\n                } else {\n                    postError(e);\n                }\n            } catch (e) {\n                console.error(\"Error on error reporting method:\" + e);\n            }\n        })();\n    }\n}(\"#{Octopus.Release.Number}\"));\n\n},{\"./lib/ab-settings.js\":1,\"./lib/widget-management.js\":5,\"./lib/widget.js\":6}]},{},[8]);\n"]}